<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS 방지 테스트</title>
    <script src="utils.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .test-input { width: 100%; height: 60px; margin: 10px 0; }
        .test-output { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .safe { border-left: 4px solid #4CAF50; }
        .unsafe { border-left: 4px solid #f44336; }
    </style>
</head>
<body>
    <h1>XSS 방지 기능 테스트</h1>
    
    <div class="test-section">
        <h2>메모 입력 테스트</h2>
        <textarea id="memo-input" class="test-input" placeholder="테스트할 메모를 입력하세요"></textarea>
        <button onclick="testMemoSanitization()">메모 정제 테스트</button>
        <div id="memo-output" class="test-output"></div>
    </div>
    
    <div class="test-section">
        <h2>동행자 입력 테스트</h2>
        <textarea id="companions-input" class="test-input" placeholder="테스트할 동행자 정보를 입력하세요"></textarea>
        <button onclick="testCompanionsSanitization()">동행자 정제 테스트</button>
        <div id="companions-output" class="test-output"></div>
    </div>
    
    <div class="test-section">
        <h2>자동 테스트 케이스</h2>
        <button onclick="runAutoTests()">자동 테스트 실행</button>
        <div id="auto-test-output" class="test-output"></div>
    </div>

    <script>
        function testMemoSanitization() {
            const input = document.getElementById('memo-input').value;
            const sanitized = sanitizeMemo(input);
            const output = document.getElementById('memo-output');
            
            output.innerHTML = `
                <h3>원본 입력:</h3>
                <div class="unsafe">${input}</div>
                <h3>정제된 출력:</h3>
                <div class="safe">${sanitized}</div>
                <h3>HTML 렌더링 테스트:</h3>
                <div class="safe">${sanitized}</div>
            `;
        }
        
        function testCompanionsSanitization() {
            const input = document.getElementById('companions-input').value;
            const sanitized = sanitizeCompanions(input);
            const output = document.getElementById('companions-output');
            
            output.innerHTML = `
                <h3>원본 입력:</h3>
                <div class="unsafe">${input}</div>
                <h3>정제된 출력:</h3>
                <div class="safe">${sanitized}</div>
                <h3>HTML 렌더링 테스트:</h3>
                <div class="safe">${sanitized}</div>
            `;
        }
        
        function runAutoTests() {
            const testInputs = [
                '<script>alert("XSS")</script>',
                '<img src="x" onerror="alert(1)">',
                '&lt;script&gt;alert("이미 이스케이프됨")&lt;/script&gt;',
                'javascript:alert("XSS")',
                '<a href="javascript:alert(1)">링크</a>',
                '정상적인 메모 내용입니다.',
                '김철수, 이영희 @username #hashtag',
                '<div style="background:red">스타일 공격</div>',
                '<iframe src="javascript:alert(1)"></iframe>',
                '안녕하세요! 여행은 즐거웠습니다 😊'
            ];
            
            let testResults = '<h3>자동 테스트 결과:</h3>';
            
            testInputs.forEach((input, index) => {
                const memoSanitized = sanitizeMemo(input);
                const companionsSanitized = sanitizeCompanions(input);
                
                testResults += `
                    <div style="margin: 15px 0; padding: 10px; border: 1px solid #ddd;">
                        <h4>테스트 케이스 ${index + 1}:</h4>
                        <p><strong>원본:</strong> ${input}</p>
                        <p><strong>메모 정제:</strong> ${memoSanitized}</p>
                        <p><strong>동행자 정제:</strong> ${companionsSanitized}</p>
                        <p><strong>HTML 렌더링:</strong></p>
                        <div style="background: #f9f9f9; padding: 5px; margin: 5px 0;">
                            메모: ${memoSanitized}
                        </div>
                        <div style="background: #f9f9f9; padding: 5px; margin: 5px 0;">
                            동행자: ${companionsSanitized}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('auto-test-output').innerHTML = testResults;
        }
    </script>
</body>
</html>
